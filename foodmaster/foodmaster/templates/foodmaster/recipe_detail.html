{% extends 'foodmaster/base.html' %}

{% block title %}Food Master - {{ recipe.name|default:"Spaghetti Carbonara" }}{% endblock %}

{% block content %}
<div class="wireframe-section">
  <div class="recipe-detail" style="display: flex; gap: 80px; align-items: flex-start;">
    
    <!-- LEFT COLUMN: Recipe Image + Nearby Markets -->
    <div style="flex: 1;">
      <!-- Recipe Image -->
      <div class="recipe-image" style="
        width: 100%;
        height: 200px;
        background-color: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
      ">
        [Recipe Image]
      </div>
      
      <!-- Nearby Markets -->
      <div class="nearby-markets" style="margin-top: 20px;">
        <h3 style="margin-bottom: 15px;">Nearby Markets</h3>
        
        <!-- Filter Form: store_type dropdown -->
        <form method="get" style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 16px;">
          <!-- Keep dish, lat, lng so we stay on the same page -->
          <input type="hidden" name="dish" value="{{ recipe.name }}">
          <input type="hidden" name="lat" value="{{ lat }}">
          <input type="hidden" name="lng" value="{{ lng }}">
          
          <label for="store_type" style="font-weight: bold;">Store Type:</label>
          <select
            id="store_type"
            name="store_type"
            onchange="this.form.submit()"
            style="
              padding: 6px;
              font-size: 16px;
              border-radius: 4px;
              border: 1px solid #ccc;
              outline: none;
              cursor: pointer;
            "
          >
            <option value="asian_store" {% if store_type == "asian_store" %}selected{% endif %}>Asian Store</option>
            <option value="food_store" {% if store_type == "food_store" %}selected{% endif %}>Food Store</option>
            <option value="grocery_store" {% if store_type == "grocery_store" %}selected{% endif %}>Grocery Store</option>
            <option value="supermarket" {% if store_type == "supermarket" %}selected{% endif %}>Supermarket</option>
          </select>
        </form>

        {% if markets and markets|length > 0 %}
          {% for market in markets %}
            <div class="market-card" style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
              
              <div style="display: flex; align-items: center; gap: 10px;">
                {% if market.photo_url %}
                  <img 
                    src="{{ market.photo_url }}" 
                    alt="{{ market.name.text }}" 
                    style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px;"
                  >
                {% else %}
                  <div style="width: 100px; height: 100px; background: #ccc; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 32px;">
                    üõí
                  </div>
                {% endif %}
                
                <div>
                  <div style="font-weight: bold; font-size: 18px; margin-bottom: 4px;">
                    {{ market.name.text.text }}
                  </div>
                  <div style="font-size: 14px; color: #555; margin-bottom: 4px;">
                    {{ market.address }}
                  </div>
                  <div style="font-size: 14px;">
                    ‚≠ê {{ market.rating }} ({{ market.distance }})
                    <span style="margin-left: 8px; color: #4CAF50;">Open</span>
                  </div>
                  {% if market.types %}
                    <div style="margin-top: 5px;">
                      {% for t in market.types %}
                        <span class="tag" style="background: #eee; padding: 3px 6px; border-radius: 4px; margin-right: 5px; font-size: 12px;">
                          {{ t }}
                        </span>
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p style="font-size: 14px; color: #666;">No nearby markets found.</p>
        {% endif %}
      </div>
    </div>
    
    <!-- RIGHT COLUMN: Recipe Content -->
    <div class="recipe-content" style="flex: 1;">
      <h2>{{ recipe.name|default:"Spaghetti Carbonara" }}</h2>
      <div style="margin-bottom: 20px;">
        <span>{{ recipe.cuisine|default:"Italian" }} ‚Ä¢ {{ recipe.time|default:"25 min" }} ‚Ä¢ {{ recipe.difficulty|default:"Easy" }} ‚Ä¢ </span>
        <span>‚≠ê {{ recipe.rating|default:"4.8" }} ({{ recipe.reviews|default:"156" }} reviews)</span>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 30px;">
        <button class="btn btn-primary">Add to Shopping List</button>
        <button class="btn btn-secondary">Save Recipe</button>
        <button class="btn btn-secondary">Share</button>
      </div>
      
      <!-- Times (No Servings Adjustment) -->
      <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        <div style="flex: 1; padding: 15px; background-color: #f9f9f9; border-radius: 8px; text-align: center;">
          <div style="font-weight: bold;">Prep Time</div>
          <div>{{ recipe.prep_time|default:"10 min" }}</div>
        </div>
        <div style="flex: 1; padding: 15px; background-color: #f9f9f9; border-radius: 8px; text-align: center;">
          <div style="font-weight: bold;">Cook Time</div>
          <div>{{ recipe.cook_time|default:"15 min" }}</div>
        </div>
      </div>
      
      <div class="tabs" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <div class="tab active" style="cursor: pointer; font-weight: bold;">Ingredients</div>
        <div class="tab" style="cursor: pointer;">Instructions</div>
        <div class="tab" style="cursor: pointer;">Nutrition</div>
        <div class="tab" style="cursor: pointer;">Reviews</div>
      </div>

      <!-- Ingredient List (Checkboxes Instead of "Add" Buttons) -->
      <div class="ingredient-list">
        <h3>Ingredients</h3>
        
        {% if recipe.ingredients %}
          {% for ingredient in recipe.ingredients %}
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>{{ ingredient.amount }} {{ ingredient.name }}</span>
          </div>
          {% endfor %}
        {% else %}
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>400g spaghetti</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>200g pancetta or guanciale, diced</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>4 large eggs</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>50g Pecorino Romano cheese, grated</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>50g Parmesan cheese, grated</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>Freshly ground black pepper</span>
          </div>
          <div class="ingredient-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <input type="checkbox" style="transform: scale(1.3);" />
            <span>Salt, to taste</span>
          </div>
        {% endif %}
        
        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;">Add All to Shopping List</button>
      </div>
    </div>
    
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        tabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        // In a real app, you would show/hide content based on the selected tab
      });
    });
  });
</script>
{% endblock %}